Xntpd - Network Time Protocol daemon
СИНТАКСИС
/usr/lib/inet/xntpd[-aAbdm] [-c  conffile] [-e  authdelay] [-f  driftfile] [-k  keyfile] [-l logfile] [-p pidfile] [-r broadcastdelay] [-s statsdir] [-t trustedkey] [-v  variable] [-V variable]
ОПИСАНИЕ
xntpd-процесс-демон операционной системы, устанавливающая и поддерживающая системное время в соответствие с серверами точного времени xntpd это полная реализация протокола NTP стандарта версии 3. Так же сохраняет совместимость с серверами версий 1 и 2.
Обычно xntpd считывает настройки из файла конфигурации во время старта. По умолчанию это /etc/inet/ntp.conf, однако его можно переопределить. Большинство этих конфигураций можно указать из командной строки.
Процесс-демон может работать в любом из нескольких режимов, включая симметричный, активный/пассивный, режимы клиента/сервера, а так же в широковещательном/многоадресном(broadcast/multicast) режимах.
РЕЖИМЫ РАБОТЫ
xntpd
различает следующие аргументы командной строки:
-a
Запрашивать аутентификацию.
-A
Не запрашивать аутентификацию.
-b
Позволяет синхронизироваться с широковещательными серверами.
-c conffile
Позволяет определить файл конфигурации. По умолчанию /etc/ntp.conf
-d
Режим отладки.
-e authdelay
Указывает время (в секундах), необходимое для вычисления поля шифрования NTP на этом    компьютере.
-f driftfile
Указывает нахождение файла сдвига. Это файл, где хранится значение погрешности       системных часов. По умолчанию /etc/ntp.conf
-k keyfile
Указывает путь к файлу, содержащему ключи аутентификации NTP.
-l logfile
Указывает файл логов, куда они будут перенаправлены из syslog.
-m
Прослушивать многоадресные сообщения и синхронизировать их, если это возможно.
-p pidfile
Указывает путь к файлу, в который запишется идентификатор процесса.
-r broadcast
Обычно процесс автоматически калибрует задержку между сервером и клиентом. если калибровка не удалась, использовать указанную задержку ( в секундах)
-s statsdir
Указывает директорию в которой будут созданы статистические файлы.
-t trustedkey
Добавляет ключ в список доверенных ключей.
-v variable
Добавляет переменную среды.
-V variable
Добавляет переменную среды в список стандартных.

ПРИМЕНЕНИЕ
Формат файла конфигурации xntpd похож на другие файлы конфигурации Unix.Комментарии начинаются с символа `# 'и распространяются до конца строки. Пустые строки игнорируются. Команды конфигурации состоят из ключевого слова, за которым следует список аргументов, разделенных пробелами. Команда должна быть записана в одну строку.

команды конфигурации
в последующих описаниях опциональные аргументы заключены в квадратные скобки : '[]', взаимоисключающие элементы разделены '|'.

peer host_address [ key # ] [ version # ][ prefer ]
Указывает, что локальный сервер должен работать в симметричном режиме с удаленным сервером host_address, указанным в команде. В этом режиме локальный сервер может быть синхронизирован с удаленным сервером. Кроме того, удаленный сервер может быть синхронизирован локальным сервером.Команда peer и последующие команды сервера и трансляции могут принимать следующие аргументы:
key
Указывает, что все пакеты, отправленные на адрес, должны включать поля аутентификации, зашифрованные с использованием указанного номера ключа. Диапазон этого числа - это целое число без знака 32 бит. По умолчанию поле шифрования выключено.

version
Указывает номер версии стандартов NTP для исходящих пакетов: 1, 2 или 3. Вариант 3 установлен по умолчанию.
prefer
Помечает хост как предпочтительный. Этот хост будет выбран для синхронизации среди множества других возможных.
server host_address [ key # ] [ version f1# ] [ prefer ] [ mode f1 # ] server
Указывает, что локальный сервер должен работать в режиме «клиент» с удаленным сервером, указанным в команде. В этом режиме локальный сервер может быть синхронизирован с удаленным сервером, но удаленный сервер никогда не может быть синхронизирован с локальным сервером.
broadcast host_address [ key # ] [ version # ] [ ttl # ]
Указывает, что локальный сервер должен работать в режиме «broadcast», когда локальный сервер отправляет периодические широковещательные сообщения сообществу клиентов в broadcast / multicast адресе, указанном в команде.
broadcastclient
Направляет локальный сервер на прослушивание широковещательных сообщений в локальной сети, чтобы обнаружить другие серверы в той же подсети. При первом прослушивании широковещательного сообщения локальный сервер измеряет номинальную задержку сети, затем переходит в режим «broadcastclient», в котором он прослушивает и синхронизируется с последующими широковещательными сообщениями. Чтобы избежать случайного или вредоносного сбоя в этом режиме, локальный и удаленный серверы должны работать с использованием аутентификации с тем же доверенным ключом и ключевым идентификатором.
driftfile filename
Указывает имя файла, используемого для записи смещения частоты локального генератора тактовых импульсов. Если файл существует, он считывается при запуске, чтобы установить начальное смещение частоты. Затем файл обновляется один раз в час с текущим смещением, вычисленным демоном. Если файл не существует или эта команда не указана, начальное смещение частоты считается равным нулю. В этом случае для стабилизации частоты может потребоваться несколько часов, а ошибки остаточного времени - ослабевать. Файл содержит одно значение с плавающей запятой, равное смещению в миллионных долях (ppm). Файл обновляется, сначала записывая текущее значение смещения во временный файл, а затем используя rename(2) для замены старой версии. Это означает, что xntpd должен иметь разрешение на запись для каталога, в котором находится файл дрифта, и, вероятно, следует избегать ссылок на файловые системы, символических или других.
 команды аутентификации
keys filename
Указывает имя файла, который содержит ключи шифрования и идентификаторы ключей, используемые xntpd при работе в режиме аутентификации. Формат этого файла описан ниже.
trustedkey  # [ # ... ]
Определяет идентификаторы ключа шифрования, используемые в целях определения одноранговых узлов, подходящих для синхронизации. Аргументы представляют собой 32-разрядные целые числа без знака.
controlkey #
Указывает идентификатор ключа для использования с программой ntpq (1M), которая полезна для диагностики и устранения проблем, влияющих на работу xntpd. Аргументом для этой команды является 32-разрядное целое число без знака. Если в файле конфигурации не включена команда controlkey или ключи не совпадают, эти запросы игнорируются.

 команды контроля доступа
restrict address [ mask numeric_mask ] [ flag ] [ ... ]
xntpd реализует общий список ограничений на основе адреса и маски. Список сортируется по IP-адресу и маске, и список выполняется в этом порядке для совпадений, с найденным последним сопоставлением, определяющим флаги ограничения, связанные с входящими пакетами. Исходный адрес входящих пакетов используется для сопоставления, при этом логический адрес 32-разрядного адреса содержит маску, связанную с записью ограничения, а затем сравнивается с адресом записи (который также был и с маской), чтобы искать соотвветствие.

 команды мониторинга
statsdir /directory_path/
отмечает полный путь к директории в которой будут размещены файлы со статистикой.
statistics name ...
Позволяет создавать записи статистики. В настоящее время поддерживаются три вида статистики. Каждый тип описан ниже, указывая его имя, примерную строку данных и объяснение каждого поля:
loopstats
позволяет записывать статистическую информацию на каждой итерации. Каждое обновление локальных часов выводит строку следующей формы в набор генерации файлов с именем «loopstats»:
48773  10847.650  0.0001307  17.3478  2
.B описания полей:
1
Дата
2
Время
3
Смещение в секундах
4
Частота смещения в частях на миллион
5
Постоянная времени алгоритма часовой синхронизации при каждом обновлении часов
clockstats
позволяет записывать статистику статистики драйверов часов. Каждое обновление, полученное от драйвера часов, выводит строку следующей формы в набор генерации файлов с именем «clockstats»:
49213  525.624  127.127.4.1  93  226  \
00:08:29.606  D
.B описания полей:
1
Дата
2
Время
3
Адрес часов
4
Последний тайм-код, полученный от часов в декодированном формате ASCII.
 
ПЕРЕМЕННЫЕ
Большинство переменных, используемых протоколом NTP, можно проверить с помощью ntpq (сообщения режима 6). В настоящее время очень мало переменных могут быть изменены через сообщения режима 6. Эти переменные создаются с помощью директивы setvar или переменных предупреждения прыжка. Биты предупреждения о прыжках, которые могут быть установлены в переменной leapwarning (до одного месяца вперед). И то, и другое, и переменная leapindication, имеют немного отличающуюся кодировку, чем обычная интерпретация скачков:
00
Демон пропускает скачки своего источника синхронизации (обычный режим работы).

01/10
Второй прыжок добавляется / удаляется (оператор вынужденный прыжок второй).
11

Информация о прыжках от источника синхронизации игнорируется (таким образом, LEAP_NOWARNING передается).
ФАЙЛЫ
/etc/inet/ntp.conf
Имя по умолчанию файла конфигурации
/etc/ntp/ntp.drift
Cтандартное имя файла сдвига
/etc/inet/ntp.keys
Стандартное имя файла ключей
/etc/inet/ntp.server
Пример файла конфигурации сервера

СМОТРИТЕ ТАКЖЕ
svcs(1), ntpdate(1M), ntpq(1M), ntptrace(1M), svcadm(1M), xntpdc(1M), rename(2), attributes(5), smf(5)
